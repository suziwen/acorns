{"componentChunkName":"component---node-modules-suziwen-gatsby-theme-sculpting-src-templates-template-blog-post-js","path":"/tech/nodejs-internals","result":{"data":{"zipFile":{"publicURL":"/acorns/static/ccf6286492958cdedc969811a8bbf2e1/Exploring Node.js Internals.zip"},"site":{"siteMetadata":{"siteUrl":"https://suziwen.github.io/acorns"}},"storyWriterMarkdown":{"id":"3b7cbb36-f691-5ace-aa21-cdbed6b25495","html":"\n\n\t<div class=\"preview html_preview xsj_export_zip\"><div style=\"overflow: hidden; position: absolute; top: 0; height: 1px; width: auto; padding: 0; border: 0; margin: 0; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;\"><svg><defs id=\"MathJax_SVG_glyphs\"/><defs xmlns=\"http://www.w3.org/2000/svg\"><filter xmlns=\"http://www.w3.org/2000/svg\" id=\"dropshadow\" height=\"130%\">      <fegaussianblur in=\"SourceAlpha\" stddeviation=\"3\"/>       <feoffset dx=\"2\" dy=\"2\" result=\"offsetblur\"/>       <femerge>         <femergenode/>        <femergenode in=\"SourceGraphic\"/>       </femerge>    </filter><filter id=\"editing-stripe-bk\" filterunits=\"userSpaceOnUse\" x=\"-100%\" y=\"-100%\" width=\"300%\" height=\"300%\"><feflood flood-color=\"#700f0f\" result=\"flood1\"/><feflood flood-color=\"#fff\" flood-opacity=\"0.5\" result=\"flood2\"/><feimage xlink:href=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAwcHgiIGhlaWdodD0iMTAwMHB4Ij48ZGVmcz48cGF0dGVybiBpZD0icGF0dGVybiIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeD0iMCIgeT0iMCIgd2lkdGg9IjQiIGhlaWdodD0iNCI+PHBhdGggZD0iTSAtNCAtNCBMIDggOCBNIC04IC00IEwgNCA4IE0gLTQgLTggTCA4IDQiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI3BhdHRlcm4pIi8+PC9zdmc+\" x=\"0\" y=\"0\" width=\"2000\" height=\"1000\" result=\"image\"/><fetile in=\"image\" result=\"tile\"/><fecomposite operator=\"in\" in=\"flood1\" in2=\"tile\" result=\"tile2\"/><fegaussianblur in=\"SourceAlpha\" stddeviation=\"10\" result=\"blur\"/><fecomposite operator=\"in\" in=\"tile2\" in2=\"blur\" result=\"cloud\"/><femorphology operator=\"dilate\" radius=\"2\" in=\"SourceAlpha\" result=\"dilate\"/><fecomposite operator=\"in\" in=\"flood2\" in2=\"dilate\" result=\"base\"/><femerge><femergenode in=\"cloud\"/><femergenode in=\"base\"/><femergenode in=\"SourceGraphic\"/></femerge></filter></defs></svg></div><blockquote class=\"markdown_blockquote\">\n<p class=\"xsj_paragraph xsj_paragraph_level_1\"><span class=\"xsj_placeholder_span\"></span>本文为转载文章,如果涉及侵权,请联系 <a href=\"mailto:suziwen1@gmail.com\" class=\"xsj_link xsj_auto_link\">suziwen1@gmail.com</a>,会第一时间删除</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_1\"><span class=\"xsj_placeholder_span\"></span>转载自: <a href=\"https://www.smashingmagazine.com/2020/04/nodejs-internals/\" class=\"xsj_link xsj_auto_link\">https://www.smashingmagazine.com/2020/04/nodejs-internals/</a></p>\n</blockquote>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"></p><div class=\"toc mindmap_toc mindmap_container\" data-hash=\"ca1152ba0eab3dac7e91f6db7274188b_mindmap_toc\"><div class=\"xsj_mindmap xsj_mindmap_toc\"><svg id=\"xsj_mindmap_toc_1588255111888\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" class=\"xsj_svg_viewbox\" style=\"max-width:1482px;max-height:752px;\" viewbox=\"0 0 1482 752\" width=\"100%\" height=\"100%\"><g transform=\"translate(367.5,398) scale(1)\"><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"1\" d=\"M341.5,-342 L346.5,-342 C382.5,-342 377.5,-342 413.5,-342 L415.5,-342\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(341.5, -342)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: white;\"/><g transform=\"translate(413.5,-342)\"><path class=\"markmap-node-path\" d=\"M0,0L94,0\" stroke-width=\"1\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(94, 0)\" points=\"0,-0.5 5,0 0,0.5 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"1\" d=\"M673.5,-38 L678.5,-38 C714.5,-38 709.5,-38 745.5,-38 L747.5,-38\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(673.5, -38)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: white;\"/><g transform=\"translate(745.5,-38)\"><path class=\"markmap-node-path\" d=\"M0,0L320,0\" stroke-width=\"1\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(320, 0)\" points=\"0,-0.5 5,0 0,0.5 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"2\" d=\"M254.5,-40.5 L259.5,-40.5 C295.5,-40.5 290.5,266 326.5,266 L328.5,266\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(254.5, -40.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(326.5,266)\"><path class=\"markmap-node-path\" d=\"M0,0L79,0\" stroke-width=\"2\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(79, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"2\" d=\"M254.5,-40.5 L259.5,-40.5 C295.5,-40.5 290.5,190 326.5,190 L328.5,190\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(254.5, -40.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(326.5,190)\"><path class=\"markmap-node-path\" d=\"M0,0L331,0\" stroke-width=\"2\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(331, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"2\" d=\"M254.5,-40.5 L259.5,-40.5 C295.5,-40.5 290.5,114 326.5,114 L328.5,114\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(254.5, -40.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(326.5,114)\"><path class=\"markmap-node-path\" d=\"M0,0L224,0\" stroke-width=\"2\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(224, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"2\" d=\"M254.5,-40.5 L259.5,-40.5 C295.5,-40.5 290.5,38 326.5,38 L328.5,38\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(254.5, -40.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(326.5,38)\"><path class=\"markmap-node-path\" d=\"M0,0L202,0\" stroke-width=\"2\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(202, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"2\" d=\"M254.5,-40.5 L259.5,-40.5 C295.5,-40.5 290.5,-38 326.5,-38 L328.5,-38\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(254.5, -40.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(326.5,-38)\"><path class=\"markmap-node-path\" d=\"M0,0L346,0\" stroke-width=\"2\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(346, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"2\" d=\"M254.5,-40.5 L259.5,-40.5 C295.5,-40.5 290.5,-114 326.5,-114 L328.5,-114\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(254.5, -40.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(326.5,-114)\"><path class=\"markmap-node-path\" d=\"M0,0L302,0\" stroke-width=\"2\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(302, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"2\" d=\"M254.5,-40.5 L259.5,-40.5 C295.5,-40.5 290.5,-190 326.5,-190 L328.5,-190\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(254.5, -40.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(326.5,-190)\"><path class=\"markmap-node-path\" d=\"M0,0L207,0\" stroke-width=\"2\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(207, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"2\" d=\"M254.5,-40.5 L259.5,-40.5 C295.5,-40.5 290.5,-266 326.5,-266 L328.5,-266\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(254.5, -40.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(326.5,-266)\"><path class=\"markmap-node-path\" d=\"M0,0L119,0\" stroke-width=\"2\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(119, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"2\" d=\"M254.5,-40.5 L259.5,-40.5 C295.5,-40.5 290.5,-342 326.5,-342 L328.5,-342\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(254.5, -40.5)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(326.5,-342)\"><path class=\"markmap-node-path\" d=\"M0,0L14,0\" stroke-width=\"2\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(14, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"4\" d=\"M131.5,-40.5 L136.5,-40.5 C208.5,-40.5 203.5,-40.5 239.5,-40.5 L241.5,-40.5\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(131.5, -40.5)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: white;\"/><g transform=\"translate(239.5,-40.5)\"><path class=\"markmap-node-path\" d=\"M0,0L14,0\" stroke-width=\"4\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(14, 0)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-node markmap-root-node\" transform=\"translate(-275.5,-40.5)\"><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(406, 0)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: rgb(51, 102, 204);\"/><g transform=\"translate(1, -36)\"><rect class=\"markmap-node-rect\" rx=\"10\" ry=\"10\" height=\"72\" width=\"405\" fill=\"rgb(78, 156, 255)\" stroke=\"#3366cc\" stroke-width=\"1\"/><text class=\"markmap-node-text\" alignment-baseline=\"middle\" x=\"203.5\" y=\"46\" text-anchor=\"middle\" style=\"font: bolder 30px sans-serif; fill-opacity: 1; fill: rgb(255, 255, 255);\">Exploring Node.js Internals</text></g></g><g class=\"markmap-node\" transform=\"translate(239.5,-40.5)\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px;\"/><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(51, 102, 204);\"/></g><g class=\"markmap-node\" transform=\"translate(326.5,266)\"><a xlink:href=\"#conclusion_10\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;\">Conclusion</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;\">Conclusion</text></a></g><g class=\"markmap-node\" transform=\"translate(326.5,190)\"><a xlink:href=\"#what20happens20with20our20file-making20program_9\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;\">What Happens With Our File-Making Program</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;\">What Happens With Our File-Making Program</text></a></g><g class=\"markmap-node\" transform=\"translate(326.5,114)\"><a xlink:href=\"#low-level20tasks20get20delegated_8\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;\">Low-Level Tasks Get Delegated</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;\">Low-Level Tasks Get Delegated</text></a></g><g class=\"markmap-node\" transform=\"translate(326.5,38)\"><a xlink:href=\"#is20nodejs20single-threaded_7\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;\">Is Node.js Single-Threaded?</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;\">Is Node.js Single-Threaded?</text></a></g><g class=\"markmap-node\" transform=\"translate(326.5,-38)\"><a xlink:href=\"#experiment20how2020creates20a20new20file_5\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;\">Experiment: How fs.writeFile Creates A New File</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;\">Experiment: How fs.writeFile Creates A New File</text></a></g><g class=\"markmap-node\" transform=\"translate(745.5,-38)\"><a xlink:href=\"#what20do20we20gain20from20this20understanding_6\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;\">What Do We Gain From This Understanding?</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;\">What Do We Gain From This Understanding?</text></a></g><g class=\"markmap-node\" transform=\"translate(326.5,-114)\"><a xlink:href=\"#interesting20apis20for20server-side20programs_4\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;\">Interesting APIs For Server-Side Programs</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;\">Interesting APIs For Server-Side Programs</text></a></g><g class=\"markmap-node\" transform=\"translate(326.5,-190)\"><a xlink:href=\"#internal20structure20of20nodejs_3\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;\">Internal Structure Of Node.js</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;\">Internal Structure Of Node.js</text></a></g><g class=\"markmap-node\" transform=\"translate(326.5,-266)\"><a xlink:href=\"#what20is20nodejs_2\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;\">What Is Node.js?</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;\">What Is Node.js?</text></a></g><g class=\"markmap-node\" transform=\"translate(326.5,-342)\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px;\"/><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204);\"/></g><g class=\"markmap-node\" transform=\"translate(413.5,-342)\"><a xlink:href=\"#prerequisites_1\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;\">Prerequisites</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;\">Prerequisites</text></a></g><g class=\"annotation-group\"><g class=\"annotations\"/></g></g></svg></div></div><p></p>\n<blockquote class=\"markdown_blockquote\">\n<p class=\"xsj_paragraph xsj_paragraph_level_1\"><span class=\"xsj_placeholder_span\"></span>Node.js is an interesting tool for web developers. With its high level of concurrency, it has become a leading candidate for people choosing tools to use in web development. In this article, we will learn about what makes up Node.js, give it a meaningful definition, understand how the internals of Node.js interact with one another, and explore the project repository for Node.js on GitHub.</p>\n</blockquote>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Since the introduction of Node.js by <a href=\"https://twitter.com/ryanmdahl\" class=\"xsj_link xsj_manu_link\">Ryan Dahl</a> at the European JSConf on 8 November 2009, it has seen wide usage across the tech industry. Companies such as Netflix, Uber, and LinkedIn give credibility to the claim that Node.js can withstand a high amount of traffic and concurrency.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Armed with basic knowledge, beginner and intermediate developers of Node.js struggle with many things: “It’s just a runtime!” “It has event loops!” “Node.js is single-threaded like JavaScript!”</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">While some of these claims are true, we will dig deeper into the Node.js runtime, understanding how it runs JavaScript, seeing whether it actually is single-threaded, and, finally, better understanding the interconnection between its core dependencies, V8 and libuv.</p>\n<h4 class=\"xsj_heading_hash xsj_heading xsj_heading_h4\" id=\"prerequisites_1\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"prerequisites_1\" class=\"blank_anchor_name\"></a><a id=\"prerequisites_1\" class=\"blank_anchor_id\"></a><a name=\"prerequisites\" class=\"blank_anchor_name\"></a><a id=\"prerequisites\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Prerequisites</span></h4>\n<ul class=\"markdown_ul\">\n<li><span class=\"xsj_placeholder_span\"></span>Basic knowledge of JavaScript</li>\n<li><span class=\"xsj_placeholder_span\"></span>Familiarity with Node.js semantics (<code>require</code>, <code>fs</code>)</li>\n</ul>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"what20is20nodejs_2\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"what20is20nodejs_2\" class=\"blank_anchor_name\"></a><a id=\"what20is20nodejs_2\" class=\"blank_anchor_id\"></a><a name=\"what-is-nodejs\" class=\"blank_anchor_name\"></a><a id=\"what-is-nodejs\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">What Is Node.js?</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">It might be tempting to assume what many people have believed about Node.js, the most common definition of it being that it’s a <strong class=\"markdown_strong_asterisk\">runtime for the JavaScript language</strong>. To consider this, we should understand what led to this conclusion.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Node.js is often described as a combination of C++ and JavaScript. The C++ part consists of bindings running low-level code that make it possible to access hardware connected to the computer. The JavaScript part takes JavaScript as its source code and runs it in a popular interpreter of the language, named the <a href=\"https://v8.dev/\" class=\"xsj_link xsj_manu_link\">V8</a> engine.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">With this understanding, we could describe Node.js as a unique tool that combines JavaScript and C++ to run programs outside of the browser environment.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">But could we actually call it a runtime? To determine that, let’s define what a runtime is.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">In one of <a href=\"https://stackoverflow.com/a/3710234/7368018\" class=\"xsj_link xsj_manu_link\">his answers</a> on StackOverflow, <a href=\"https://stackoverflow.com/users/82511/djna\" class=\"xsj_link xsj_manu_link\">DJNA</a> defines a runtime environment as “everything you need to execute a program, but no tools to change it”. According to this definition, we can confidently say that everything that is happening while we run our code (in any language whatsoever) is running in a runtime environment.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Other languages have their own runtime environment. For Java, it is the Java Runtime Environment (JRE). For .NET, it is the Common Language Runtime (CLR). For Erlang, it is BEAM.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Nevertheless, some of these runtimes have other languages that depend on them. For example, Java has Kotlin, a programming language that compiles to code that a JRE can understand. Erlang has Elixir. And we know there are many variants for .NET development, which all run in the CLR, known as the .NET Framework.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Now we understand that a runtime is an environment provided for a program to be able to execute successfully, and we know that V8 and a host of C++ libraries make it possible for a Node.js application to execute. Node.js itself is the actual runtime that binds everything together to make those libraries an entity, and it understands just one language — JavaScript — regardless of what Node.js is built with.</p>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"internal20structure20of20nodejs_3\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"internal20structure20of20nodejs_3\" class=\"blank_anchor_name\"></a><a id=\"internal20structure20of20nodejs_3\" class=\"blank_anchor_id\"></a><a name=\"internal-structure-of-nodejs\" class=\"blank_anchor_name\"></a><a id=\"internal-structure-of-nodejs\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Internal Structure Of Node.js</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">When we attempt to run a Node.js program (such as <code>index.js</code>) from our command line using the command <code>node index.js</code>, we are calling the Node.js runtime. This runtime, as mentioned, consists of two independent dependencies, V8 and libuv.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"></p><div class=\"story_image_container story_block_image\"><div class=\"story_image\"><div class=\"gatsby-wrapper-image\" style=\"display:inline-block;max-width: 100%;width:400px; margin-left: auto; margin-right: auto;position:relative;\"><div style=\"width:100%;display:block;padding-bottom: 77.34374999999999%;\"></div><img class=\"background_image\" src=\"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='310'%3e%3cpath%20d='M0%2031v30h401V0H0v31m0%200v30l200-1h199V1H0v30m312-7c0%202%200%203-2%202-3%200-5%202-5%206%200%205%201%206%206%206h4v-8c0-5-1-7-2-8l-1%202M183%2035l1%208%201-3c0-2%200-3%203-2%203%200%205-2%205-6s-2-5-6-6h-4v9m39-8c-2%201-3%208-1%2010s7%201%208-1c3-6-2-12-7-9m73%201c-4%204-2%2010%203%2010%204%200%205-2%205-6%200-6-5-8-8-4m-98%2049v13l-4-2-5-2%206%2012%206%2010%2011-22-5%202-4%202V64h-5v13m-1%2060c0%203%200%204-1%203-6-6-14%207-8%2015%201%202%206%203%208%201h1c3%202%203%201%203-11l-1-12c-2%200-2%201-2%204m-51%208l1%2012c2%200%202-2%202-9l1-9%205%209c8%2013%209%2012%209-2l-1-12c-2%200-2%202-2%208v9l-6-8c-3-6-5-9-7-9s-2%200-2%2011m80-9l2%201c3%200%203%2016-1%2017-1%200-2%200-3-2%200-2-2-3-3-1-2%202%203%206%206%206%206%200%207-3%207-13v-10h-4c-3%200-4%200-4%202m14%200c-4%204-1%208%206%2010s8%203%206%206c-1%203-8%203-10%200-3-3-6-1-3%202%204%205%2017%203%2017-4%200-2-3-6-5-6-4%200-9-2-9-4%200-4%206-5%209-2%202%202%204%202%204%200%200-4-11-6-15-2m-70%205c-5%206-1%2016%206%2016%205%200%207-3%207-9%200-8-7-12-13-7m37-1l-3%205c-3%208%205%2016%2012%2010%203-2%202-4-1-2-4%202-8%201-8-3l6-1h6v-3c-1-6-7-9-12-6m-88%2053l-1%2012-4-2-4-1%2011%2022%2012-23-4%202c-6%203-6%203-6-10%200-12%200-13-2-13s-2%201-2%2013m169%200l-1%2012-4-2-4-1%2011%2022%2012-23-4%202c-6%203-6%203-6-11%200-12%200-12-2-12s-2%200-2%2013m-185%2068l3%2010c3%208%204%209%206%209%203%200%203-1%207-10%204-11%204-11%201-11-2%200-3%202-5%208l-3%208-2-8c-2-6-3-8-5-8-1%200-2%200-2%202m23-1c-3%202-3%205-2%207%202%202%202%203%200%204-5%205%206%2013%2012%208%202-1%203-7%201-9v-2c5-5-6-12-11-8m133%202l-1%209v8h7l7-1c0-2-1-2-4-2h-5v-7c0-7-2-10-4-7m22%208v9h5c4%200%205%200%207-2%203-6-1-13-6-11-2%200-2%200-2-2s-1-3-2-3c-2%200-2%201-2%209m15%202l1%207h11v-7c0-6%200-7-2-7s-2%201-2%205-1%206-2%206c-2%200-2-1-2-5s-1-6-2-6c-2%200-2%201-2%207m14-5c0%205%204%2012%206%2012%203%200%203%200%205-5l2-8c0-2-3-1-4%201l-2%205c-1%202-1%202-2-2-2-5-5-7-5-3'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e\" style=\"position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"><img src=\"/acorns/static/41a54bfb8880f9ea18834de7dbfe106e/e17e5/1588218242975.png\" alt=\"Core Node.js dependencies\" title=\"Core Node.js dependencies\" name=\"images/1588218242975.png\" data-src=\"./images/1588218242975.png\" class=\"front_image\" loading=\"lazy\" srcSet=\"/acorns/static/41a54bfb8880f9ea18834de7dbfe106e/6f3f2/1588218242975.png 256w,\n/acorns/static/41a54bfb8880f9ea18834de7dbfe106e/e17e5/1588218242975.png 400w\" sizes=\"(max-width: 400px) 100vw, 400px\" data-action=\"zoom\" style=\"max-width: 100%;position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"></div><br><div class=\"story_image_caption \">Core Node.js dependencies</div></div></div><p></p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">V8 is a project created and maintained by Google. It takes JavaScript source code and runs it outside of the browser environment. When we run a program through a <code>node</code> command, the source code is passed by the Node.js runtime to V8 for execution.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">The libuv library contains C++ code that enables low-level access to the operating system. Functionality such as networking, writing to the file system, and concurrency are not shipped by default in V8, which is the part of Node.js that runs our JavaScript code. With its set of libraries, libuv provides these utilities and more in a Node.js environment.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Node.js is the glue that holds the two libraries together, thereby becoming a unique solution. Throughout the execution of a script, Node.js understands which project to pass control to and when.</p>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"interesting20apis20for20server-side20programs_4\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"interesting20apis20for20server-side20programs_4\" class=\"blank_anchor_name\"></a><a id=\"interesting20apis20for20server-side20programs_4\" class=\"blank_anchor_id\"></a><a name=\"interesting-apis-for-server-side-programs\" class=\"blank_anchor_name\"></a><a id=\"interesting-apis-for-server-side-programs\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Interesting APIs For Server-Side Programs</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">If we study a little history of JavaScript, we would know that it’s meant to add some functionality and interaction to a page in the browser. And in the browser, we would interact with the elements of the document object model (DOM) that make up the page. For this, a set of APIs exists, referred to collectively as the DOM API.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">The DOM exists only in the browser; it is what is parsed to render a page, and it is basically written in the markup language known as HTML. Also, the browser exists in a window, hence the <code>window</code> object, which acts as a root for all of the objects on the page in a JavaScript context. This environment is called the browser environment, and it is a runtime environment for JavaScript.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"></p><div class=\"story_image_container story_block_image\"><div class=\"story_image\"><div class=\"gatsby-wrapper-image\" style=\"display:inline-block;max-width: 100%;width:400px; margin-left: auto; margin-right: auto;position:relative;\"><div style=\"width:100%;display:block;padding-bottom: 92.1875%;\"></div><img class=\"background_image\" src=\"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='369'%3e%3cpath%20d='M91%2096c-2%201-2%2012%201%2012l1-3c0-3%200-4%202-4l1%204c0%202%200%203%202%203l1-3c0-5%202-6%202-1%200%203%201%204%204%204l4-2h-2l-3-1%203-1c3%200%203%200%202-2s-2-3-5-3c-4%200-6-1-4-2v-1c-1-1-4%200-4%202l-1%201-2-1%201-1%201-1h-4m95%2025c0%203%200%204-1%203-4-3-10%201-10%207s6%2011%2010%207h1l2%201c2%200%202-1%202-11s0-11-2-11-2%201-2%204m46-2c-4%201-5%202-5%205s1%205%207%206l5%203c0%202-4%203-7%201h-6c0%205%2012%207%2016%203s2-8-5-10c-6-2-7-4-2-5l3%201%203%201c2%200%203-2%201-4-2-1-8-2-10-1m-96%2010c0%209%200%2010%202%2010s2-1%202-7l1-7%204%207c3%206%204%207%206%207h3v-10c0-9%200-10-2-10s-2%201-2%207v8l-4-8c-4-6-4-7-7-7h-3v10m78-8l2%201c2%200%202%201%202%207%200%205%200%206-2%206l-2-1-2-1c-3%200-4%202-1%204%202%203%208%202%2010%200%202-1%202-4%202-10v-8h-4c-4%200-5%200-5%202m-54%204c-4%203-4%209-1%2012s9%203%2012-1c6-8-3-17-11-11m35%200c-7%207%203%2018%2011%2013%203-3%200-5-3-3-3%201-5%201-5-2l5-1c5%200%205%200%205-3-2-6-9-8-13-4m-89%2044c-1%202%200%2011%202%2011l1-4c0-4%201-5%203-2l2%202%203%201-3%201c-4-1-4%201%200%202%205%201%208-3%203-6-3-1-4-2-1-1l3-1c-1-2-5-3-6-1l-3-1v-1l1-1c0-2-4-1-5%201m154%2016c0%204%200%205%202%205l1-3c0-6%203-5%205%200%201%203%201%203-1%205v2l3-1c2-1%205-10%205-12s-2-1-3%202l-2%204v-4c-1-3-1-3-6-3h-4v5m-72%2092l-1%2020-4-2c-5-3-5-3-2%204l3%206-88%201c-96%200-92%200-95%205l-1%2027c0%2025%200%2028%206%2030l195%201h193l2-3%203-4%201-1%201-25c0-16%200-24-1-23h-1l-3-4-2-2-99-1h-99l3-6c4-7%203-8-2-5l-4%202-1-20c0-20%200-21-2-21s-2%201-2%2021M4%20310l-2%203-1%201c-1-1-1%207-1%2024l1%2024h1l2%203c2%202%203%202%20196%202h194l2-2c3-4%203-52%200-55l-3-2H200C7%20308%206%20308%204%20310m216%2019l-1%209c0%208%200%208%202%208h3c0%202%203%201%205-1%204-4%201-13-4-12-3%201-3%200-3-2%200-3-1-4-2-2m-60%201l-1%205v4c-3%205%204%2010%209%207%202-2%203-6%201-8v-3c2-5-5-9-9-5'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e\" style=\"position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"><img src=\"/acorns/static/57ef371d4ad112a46865607f2b06fc98/e17e5/1588218242983.png\" alt=\"Node.js APIs call libuv for some functions\" title=\"Node.js APIs call libuv for some functions\" name=\"images/1588218242983.png\" data-src=\"./images/1588218242983.png\" class=\"front_image\" loading=\"lazy\" srcSet=\"/acorns/static/57ef371d4ad112a46865607f2b06fc98/6f3f2/1588218242983.png 256w,\n/acorns/static/57ef371d4ad112a46865607f2b06fc98/e17e5/1588218242983.png 400w\" sizes=\"(max-width: 400px) 100vw, 400px\" data-action=\"zoom\" style=\"max-width: 100%;position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"></div><br><div class=\"story_image_caption \">Node.js APIs call libuv for some functions</div></div></div><p></p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">In a Node.js environment, we have nothing like a page, nor a browser — this nullifies our knowledge of the global <a href=\"https://developer.mozilla.org/en/docs/Web/API/Window\" class=\"xsj_link xsj_manu_link\">window object</a>. What we do have is a set of APIs that interact with the operating system to provide additional functionality to a JavaScript program. These APIs for Node.js (<code>fs</code>, <code>path</code>, <code>buffer</code>, <code>events</code>, <code>HTTP</code>, and so on), as we have them, exist only for Node.js, and they are provided by Node.js (itself a runtime) so that we can run programs written for Node.js.</p>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"experiment20how2020creates20a20new20file_5\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"experiment20how2020creates20a20new20file_5\" class=\"blank_anchor_name\"></a><a id=\"experiment20how2020creates20a20new20file_5\" class=\"blank_anchor_id\"></a><a name=\"experiment-how-creates-a-new-file\" class=\"blank_anchor_name\"></a><a id=\"experiment-how-creates-a-new-file\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Experiment: How <code>fs.writeFile</code> Creates A New File</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">If V8 was created to run JavaScript outside of the browser, and if a Node.js environment does not have the same context or environment as a browser, then how would we do something like access the file system or make an HTTP server?</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">As an example, let’s take a simple Node.js application that writes a file to the file system in the current directory:</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-javascript hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-keyword\">const</span> fs = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"fs\"</span>)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span>fs.writeFile(<span class=\"hljs-string\">\"./test.txt\"</span>, <span class=\"hljs-string\">\"text\"</span>);<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">As shown, we are trying to write a new file to the file system. This feature is not available in the JavaScript language; it is available only in a Node.js environment. How does this get executed?</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">To understand this, let’s take a tour of the Node.js code base.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Heading over to the GitHub <a href=\"https://github.com/nodejs/node\" class=\"xsj_link xsj_manu_link\">repository for Node.js</a>, we see two main folders, <code>src</code> and <code>lib</code>. The <code>lib</code> folder has the JavaScript code that provides the nice set of modules that are included by default with every Node.js installation. The <code>src</code> folder contains the C++ libraries for libuv.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">If we look in the <code>src</code> folder and go through the <a href=\"https://github.com/nodejs/node/blob/master/lib/fs.js\" class=\"xsj_link xsj_manu_link\"><code>fs.js</code> file</a>, we will see that it is full of impressive JavaScript code. On <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/lib/fs.js#L1880\" class=\"xsj_link xsj_manu_link\">line 1880</a>, we will notice an <code>exports</code> statement. This statement exports everything we can access by importing the <code>fs</code> module, and we can see that it exports a function named <code>writeFile</code>.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Searching for <code>function writeFile(</code> (where the function is defined) leads us to <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/lib/fs.js#L1303\" class=\"xsj_link xsj_manu_link\">line 1303</a>, where we see that the function is defined with four parameters:</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-javascript hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">writeFile</span>(<span class=\"hljs-params\">path, data, options, callback</span>) </span>{<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span>  callback = maybeCallback(callback || options);<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span>  options = getOptions(options, { <span class=\"hljs-attr\">encoding</span>: <span class=\"hljs-string\">'utf8'</span>, <span class=\"hljs-attr\">mode</span>: <span class=\"hljs-number\">0o666</span>, <span class=\"hljs-attr\">flag</span>: <span class=\"hljs-string\">'w'</span> });<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"4\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">4</span>  <span class=\"hljs-keyword\">const</span> flag = options.flag || <span class=\"hljs-string\">'w'</span>;<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"5\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">5</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"6\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">6</span>  <span class=\"hljs-keyword\">if</span> (!isArrayBufferView(data)) {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"7\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">7</span>    validateStringAfterArrayBufferView(data, <span class=\"hljs-string\">'data'</span>);<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"8\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">8</span>    data = Buffer.from(data, options.encoding || <span class=\"hljs-string\">'utf8'</span>);<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"9\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">9</span>  }<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"10\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">10</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"11\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">11</span>  <span class=\"hljs-keyword\">if</span> (isFd(path)) {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"12\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">12</span>    <span class=\"hljs-keyword\">const</span> isUserFd = <span class=\"hljs-literal\">true</span>;<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"13\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">13</span>    writeAll(path, isUserFd, data, <span class=\"hljs-number\">0</span>, data.byteLength, callback);<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"14\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">14</span>    <span class=\"hljs-keyword\">return</span>;<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"15\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">15</span>  }<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"16\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">16</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"17\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">17</span>  fs.open(path, flag, options.mode, (openErr, fd) =&gt; {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"18\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">18</span>    <span class=\"hljs-keyword\">if</span> (openErr) {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"19\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">19</span>      callback(openErr);<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"20\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">20</span>    } <span class=\"hljs-keyword\">else</span> {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"21\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">21</span>      <span class=\"hljs-keyword\">const</span> isUserFd = <span class=\"hljs-literal\">false</span>;<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"22\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">22</span>      writeAll(fd, isUserFd, data, <span class=\"hljs-number\">0</span>, data.byteLength, callback);<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"23\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">23</span>    }<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"24\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">24</span>  });<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"25\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">25</span>}<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">On lines <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/lib/fs.js#L1315\" class=\"xsj_link xsj_manu_link\">1315</a> and <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/lib/fs.js#L1324\" class=\"xsj_link xsj_manu_link\">1324</a>, we see that a single function, <code>writeAll</code>, is called after some validation checks. We find this function on <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/lib/fs.js#L1278\" class=\"xsj_link xsj_manu_link\">line 1278</a> in the same <a href=\"https://github.com/nodejs/node/blob/master/lib/fs.js\" class=\"xsj_link xsj_manu_link\"><code>fs.js</code> file</a>.</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-language-javascript hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>function writeAll(fd, isUserFd, buffer, offset, length, callback) {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span>  // write(fd, buffer, offset, length, position, callback)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span>  fs.write(fd, buffer, offset, length, null, (writeErr, written) =&gt; {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"4\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">4</span>    if (writeErr) {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"5\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">5</span>      if (isUserFd) {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"6\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">6</span>        callback(writeErr);<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"7\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">7</span>      } else {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"8\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">8</span>        fs.close(fd, function close() {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"9\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">9</span>          callback(writeErr);<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"10\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">10</span>        });<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"11\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">11</span>      }<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"12\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">12</span>    } else if (written === length) {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"13\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">13</span>      if (isUserFd) {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"14\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">14</span>        callback(null);<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"15\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">15</span>      } else {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"16\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">16</span>        fs.close(fd, callback);<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"17\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">17</span>      }<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"18\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">18</span>    } else {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"19\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">19</span>      offset += written;<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"20\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">20</span>      length -= written;<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"21\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">21</span>      writeAll(fd, isUserFd, buffer, offset, length, callback);<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"22\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">22</span>    }<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"23\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">23</span>  });<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"24\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">24</span>}<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">It is also interesting to note that this module is attempting to call itself. We see this on <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/lib/fs.js#L1280\" class=\"xsj_link xsj_manu_link\">line 1280</a>, where it is calling <code>fs.write</code>. Looking for the <code>write</code> function, we will discover a little information.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">The <code>write</code> function starts on <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/lib/fs.js#L571\" class=\"xsj_link xsj_manu_link\">line 571</a>, and it runs about <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/lib/fs.js#L571-#L613\" class=\"xsj_link xsj_manu_link\">42 lines</a>. We see a recurring pattern in this function: the way it calls a function on the <code>binding</code> module, as seen on lines <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/lib/fs.js#L594\" class=\"xsj_link xsj_manu_link\">594</a> and <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/lib/fs.js#L612\" class=\"xsj_link xsj_manu_link\">612</a>. A function on the <code>binding</code> module is called not only in this function, but in virtually any function that is exported in the <a href=\"https://github.com/nodejs/node/blob/master/lib/fs.js\" class=\"xsj_link xsj_manu_link\"><code>fs.js</code> file</a> file. Something must be very special about it.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">The <code>binding</code> variable is declared on <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/lib/fs.js#L58\" class=\"xsj_link xsj_manu_link\">line 58</a>, at the very top of the file, and a click on that function call reveals some information, with the help of GitHub.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"></p><div class=\"story_image_container story_block_image\"><div class=\"story_image\"><div class=\"gatsby-wrapper-image\" style=\"display:inline-block;max-width: 100%;width:400px; margin-left: auto; margin-right: auto;position:relative;\"><div style=\"width:100%;display:block;padding-bottom: 19.921875%;\"></div><img class=\"background_image\" src=\"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='80'%3e%3cpath%20d='M112%2050a5707%205707%200%200065%202c3%200%202-3%200-3-1-1-2%200-2%201h-1c-1-2-62-2-62%200'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e\" style=\"position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"><img src=\"/acorns/static/cd4f58d5021c5bb81d6b7f23d9498663/e17e5/1588218242987.png\" alt=\"Declaration of the binding variable\" title=\"Declaration of the binding variable\" name=\"images/1588218242987.png\" data-src=\"./images/1588218242987.png\" class=\"front_image\" loading=\"lazy\" srcSet=\"/acorns/static/cd4f58d5021c5bb81d6b7f23d9498663/6f3f2/1588218242987.png 256w,\n/acorns/static/cd4f58d5021c5bb81d6b7f23d9498663/e17e5/1588218242987.png 400w\" sizes=\"(max-width: 400px) 100vw, 400px\" data-action=\"zoom\" style=\"max-width: 100%;position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"></div><br><div class=\"story_image_caption \">Declaration of the binding variable</div></div></div><p></p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">This <code>internalBinding</code> function is found in the module named <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/lib/internal/bootstrap/loaders.js\" class=\"xsj_link xsj_manu_link\">loaders</a>. The main function of the loaders module is to load all libuv libraries and connect them through the V8 project with Node.js. How it does this is rather magical, but to learn more we can look closely at the <code>writeBuffer</code> function that is called by the <code>fs</code> module.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">We should look where this connects with libuv, and where V8 comes in. At the top of the loaders module, some good documentation there states this:</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-javascript hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-comment\">// This file is compiled and run by node.cc before bootstrap/node.js</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span><span class=\"hljs-comment\">// was called, therefore the loaders are bootstraped before we start to</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span><span class=\"hljs-comment\">// actually bootstrap Node.js. It creates the following objects:</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"4\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">4</span><span class=\"hljs-comment\">//</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"5\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">5</span><span class=\"hljs-comment\">// C++ binding loaders:</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"6\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">6</span><span class=\"hljs-comment\">// - process.binding(): the legacy C++ binding loader, accessible from user land</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"7\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">7</span><span class=\"hljs-comment\">//   because it is an object attached to the global process object.</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"8\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">8</span><span class=\"hljs-comment\">//   These C++ bindings are created using NODE_BUILTIN_MODULE_CONTEXT_AWARE()</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"9\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">9</span><span class=\"hljs-comment\">//   and have their nm_flags set to NM_F_BUILTIN. We do not make any guarantees</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"10\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">10</span><span class=\"hljs-comment\">//   about the stability of these bindings, but still have to take care of</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"11\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">11</span><span class=\"hljs-comment\">//   compatibility issues caused by them from time to time.</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"12\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">12</span><span class=\"hljs-comment\">// - process._linkedBinding(): intended to be used by embedders to add</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"13\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">13</span><span class=\"hljs-comment\">//   additional C++ bindings in their applications. These C++ bindings</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"14\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">14</span><span class=\"hljs-comment\">//   can be created using NODE_MODULE_CONTEXT_AWARE_CPP() with the flag</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"15\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">15</span><span class=\"hljs-comment\">//   NM_F_LINKED.</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"16\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">16</span><span class=\"hljs-comment\">// - internalBinding(): the private internal C++ binding loader, inaccessible</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"17\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">17</span><span class=\"hljs-comment\">//   from user land unless through `require('internal/test/binding')`.</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"18\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">18</span><span class=\"hljs-comment\">//   These C++ bindings are created using NODE_MODULE_CONTEXT_AWARE_INTERNAL()</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"19\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">19</span><span class=\"hljs-comment\">//   and have their nm_flags set to NM_F_INTERNAL.</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"20\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">20</span><span class=\"hljs-comment\">//</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"21\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">21</span><span class=\"hljs-comment\">// Internal JavaScript module loader:</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"22\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">22</span><span class=\"hljs-comment\">// - NativeModule: a minimal module system used to load the JavaScript core</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"23\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">23</span><span class=\"hljs-comment\">//   modules found in lib/**/*.js and deps/**/*.js. All core modules are</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"24\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">24</span><span class=\"hljs-comment\">//   compiled into the node binary via node_javascript.cc generated by js2c.py,</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"25\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">25</span><span class=\"hljs-comment\">//   so they can be loaded faster without the cost of I/O. This class makes the</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"26\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">26</span><span class=\"hljs-comment\">//   lib/internal/*, deps/internal/* modules and internalBinding() available by</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"27\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">27</span><span class=\"hljs-comment\">//   default to core modules, and lets the core modules require itself via</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"28\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">28</span><span class=\"hljs-comment\">//   require('internal/bootstrap/loaders') even when this file is not written in</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"29\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">29</span><span class=\"hljs-comment\">//   CommonJS style.</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">What we learn here is that for every module called from the <code>binding</code> object in the JavaScript section of the Node.js project, there is an equivalent of it in the C++ section, in the <code>src</code> folder.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">From our <code>fs</code> tour, we see that the module that does this is located <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/src/node_file.cc\" class=\"xsj_link xsj_manu_link\">in <code>node_file.cc</code></a>. Every function that is accessible through the module is defined in the file; for example, we have the <code>writeBuffer</code> on <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/src/node_file.cc#L2258\" class=\"xsj_link xsj_manu_link\">line 2258</a>. The actual definition of that method in the C++ file is on <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/src/node_file.cc#L1785\" class=\"xsj_link xsj_manu_link\">line 1785</a>. Also, the call to the part of libuv that does the actual writing to the file can be found on lines <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/src/node_file.cc#L1809\" class=\"xsj_link xsj_manu_link\">1809</a> and <a href=\"https://github.com/nodejs/node/blob/cd1db2db48d28db805227e7f6ade79a106d85bc6/src/node_file.cc#L1815\" class=\"xsj_link xsj_manu_link\">1815</a>, where the libuv function <code>uv_fs_write</code> is called asynchronously.</p>\n<h4 class=\"xsj_heading_hash xsj_heading xsj_heading_h4\" id=\"what20do20we20gain20from20this20understanding_6\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"what20do20we20gain20from20this20understanding_6\" class=\"blank_anchor_name\"></a><a id=\"what20do20we20gain20from20this20understanding_6\" class=\"blank_anchor_id\"></a><a name=\"what-do-we-gain-from-this-understanding\" class=\"blank_anchor_name\"></a><a id=\"what-do-we-gain-from-this-understanding\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">What Do We Gain From This Understanding?</span></h4>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Just like many other interpreted language runtimes, the runtime of Node.js can be hacked. With greater understanding, we could do things that are impossible with the standard distribution just by looking through the source. We could add libraries to make changes to the way some functions are called. But above all, this understanding is a foundation for further exploration.</p>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"is20nodejs20single-threaded_7\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"is20nodejs20single-threaded_7\" class=\"blank_anchor_name\"></a><a id=\"is20nodejs20single-threaded_7\" class=\"blank_anchor_id\"></a><a name=\"is-nodejs-single-threaded\" class=\"blank_anchor_name\"></a><a id=\"is-nodejs-single-threaded\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Is Node.js Single-Threaded?</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Sitting on libuv and V8, Node.js has access to some additional functionalities that a typical JavaScript engine running in the browser does not have.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Any JavaScript that runs in a browser will execute in a single thread. A thread in a program’s execution is just like a black box sitting on top of the CPU in which the program is being executed. In a Node.js context, some code could be executed in as many threads as our machines can carry.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">To verify this particular claim, let’s explore a simple code snippet.</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-javascript hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-keyword\">const</span> fs = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"fs\"</span>);<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span><span class=\"hljs-comment\">// A little benchmarking</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span><span class=\"hljs-keyword\">const</span> startTime = <span class=\"hljs-built_in\">Date</span>.now()<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"4\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">4</span>fs.writeFile(<span class=\"hljs-string\">\"./test.txt\"</span>, <span class=\"hljs-string\">\"test\"</span>, (err) =&gt; {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"5\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">5</span>    If (error) {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"6\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">6</span>        <span class=\"hljs-built_in\">console</span>.log(err)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"7\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">7</span>    }<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"8\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">8</span>    <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"1 Done: \"</span>, <span class=\"hljs-built_in\">Date</span>.now() — startTime)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"9\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">9</span>});<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">In the snippet above, we are trying to create a new file on the disk in the current directory. To see how long this could take, we’ve added a little benchmark to monitor the start time of the script, which gives us the duration in milliseconds of the script that is creating the file.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">If we run the code above, we will get a result like this:</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"></p><div class=\"story_image_container story_block_image\"><div class=\"story_image\"><div class=\"gatsby-wrapper-image\" style=\"display:inline-block;max-width: 100%;width:400px; margin-left: auto; margin-right: auto;position:relative;\"><div style=\"width:100%;display:block;padding-bottom: 40.625%;\"></div><img class=\"background_image\" src=\"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='162'%3e%3cpath%20d='M39%209c36%200%2040%201%2041%202v4c-2%202-3%202-37%202a16181%2016181%200%2000-41%201l1%202c0%203-2%204-2%201-1-1-1-1-1%201v2h39c37%200%2039%200%2041%202v4c-2%202-4%202-41%202H0v8h39c39%200%2040%200%2041%202s1%203-1%204c-1%202-3%202-40%202H0v8h40c36%200%2039%201%2040%202v4c-2%202-3%202-14%202a541%20541%200%2000-64%202c1-1%201%200%201%202v3h9c5%200%208%200%207-1l-1-1h-2c0%202-9%201-9-1s2-3%203-2h4l4%201h1l2-1%201%203-1%202h12c13%200%2013%200%2012-5h5l1%201v3c-1%201%204%201%2013%201%2012%200%2014%200%2015%202%202%202%202%202%201%204s-2%202-41%202L0%2080c0%201%201%202%202%201l1%202c0%203-2%204-2%201-1-1-1-1-1%201v2h39c39%200%2040%200%2041%202s1%202-1%204c-1%202-3%202-40%202H0v8h40c36%200%2039%201%2040%202v4c-2%202-3%202-41%202H0v51h401V89l-1-77V8H200L39%209m70%204l-3%202-2%201c0%201%2031%202%2032%200%201-1%200-5-2-5h-1l-1-1-1%203c0%202%200%202-3%202s-5-2-3-3c1-1%201-1-2-1v5l-1-3-4-2-3%202c-1%202-1%202-1-1l-2-1v2l-1%202-1-2c1-4-1-4-1%200m0%2014c0%202-2%205-3%203l-2%201c-1%201%201%201%2013%201l20-1c1%200-1-4-3-4h-1l-1-1-1%203c0%202-1%203-3%201h-3v-2c2-1%200-2-2-1h-5c-2%200-3%201-3%202l-1%201-1-1v-2l-1%202-1%202c-2%200-2-1-1-2v-3l-1%201m0%2017c-2%203-2%204-3%202l-2%201c-1%201%201%201%2016%201s17%200%2016-2v-2l-2-1-2-1h-1v3l-1%202-2-1h-3v-2c2-1-1-2-4-1l-2%202-1%202v-3l-1-1-2%202c0%201%200%202-1%201l-1-1v-2l-2-1c-1-1-1-1-2%202m0%2016l-3%202-2%201%2016%201%2017-1c0-2-1-5-3-5h-1l-1-1-1%203c0%202%200%202-3%202s-3-1-3-2l-1-2-1%202v3l-1-3-4-2-3%202c-1%202-1%202-1%200l-1-2-1%202-1%202-1-2c1-4-1-4-1%200m0%2016l-2%202h-3c-2%201-3%201%2018%201h15c1-1-1-5-3-5h-1l-1-1-1%203c0%202%200%202-3%202-4-1-5-2-3-3s0-2-2-1h-5c-2%200-3%201-3%202l-1%201-1-1v-2l-1%202-1%202c-2%200-2-1-1-2v-3l-1%203m22%2013v3l-1%202-2-1h-3v-2c2-1%200-2-2-1h-5c-2%200-3%201-3%202s0%202-1%201l-1-2v-1l-1%202-1%202c-2%200-2-1-1-2v-3l-2%203c0%202-2%203-2%201l-2%201c-1%201%201%201%2016%201s17%200%2016-2v-2c0-2-2-1-2%201s0%202-1-1-2-4-2-2'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e\" style=\"position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"><img src=\"/acorns/static/86e71e9302ba4900cec26a75847e3bf0/e17e5/1588218243002.png\" alt=\"Result of the time it takes to create a single file in Node.js\" title=\"Result of the time it takes to create a single file in Node.js\" name=\"images/1588218243002.png\" data-src=\"./images/1588218243002.png\" class=\"front_image\" loading=\"lazy\" srcSet=\"/acorns/static/86e71e9302ba4900cec26a75847e3bf0/6f3f2/1588218243002.png 256w,\n/acorns/static/86e71e9302ba4900cec26a75847e3bf0/e17e5/1588218243002.png 400w\" sizes=\"(max-width: 400px) 100vw, 400px\" data-action=\"zoom\" style=\"max-width: 100%;position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"></div><br><div class=\"story_image_caption \">Result of the time it takes to create a single file in Node.js</div></div></div><p></p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-javascript hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>$ node ./test.js<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span>    -&gt; <span class=\"hljs-number\">1</span> Done: <span class=\"hljs-number\">0.003</span>s<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">This is very impressive: just 0.003 seconds.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">But let’s do something really interesting. First let’s duplicate the code that generates the new file, and update the number in the log statement to reflect their positions:</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-javascript hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-keyword\">const</span> fs = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">\"fs\"</span>);<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span><span class=\"hljs-comment\">// A little benchmarking</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span><span class=\"hljs-keyword\">const</span> startTime = <span class=\"hljs-built_in\">Date</span>.now()<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"4\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">4</span>fs.writeFile(<span class=\"hljs-string\">\"./test1.txt\"</span>, <span class=\"hljs-string\">\"test\"</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">err</span>) </span>{<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"5\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">5</span>     <span class=\"hljs-keyword\">if</span> (err) {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"6\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">6</span>        <span class=\"hljs-built_in\">console</span>.log(err)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"7\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">7</span>    }<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"8\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">8</span>    <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"1 Done: %ss\"</span>, (<span class=\"hljs-built_in\">Date</span>.now() — startTime) / <span class=\"hljs-number\">1000</span>)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"9\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">9</span>});<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"10\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">10</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"11\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">11</span>fs.writeFile(<span class=\"hljs-string\">\"./test2.txt\"</span>, <span class=\"hljs-string\">\"test\"</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">err</span>) </span>{<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"12\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">12</span>     <span class=\"hljs-keyword\">if</span> (err) {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"13\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">13</span>        <span class=\"hljs-built_in\">console</span>.log(err)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"14\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">14</span>    }<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"15\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">15</span>    <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"2 Done: %ss\"</span>, (<span class=\"hljs-built_in\">Date</span>.now() — startTime) / <span class=\"hljs-number\">1000</span>)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"16\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">16</span>});<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"17\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">17</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"18\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">18</span>fs.writeFile(<span class=\"hljs-string\">\"./test3.txt\"</span>, <span class=\"hljs-string\">\"test\"</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">err</span>) </span>{<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"19\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">19</span>     <span class=\"hljs-keyword\">if</span> (err) {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"20\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">20</span>        <span class=\"hljs-built_in\">console</span>.log(err)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"21\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">21</span>    }<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"22\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">22</span>    <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"3 Done: %ss\"</span>, (<span class=\"hljs-built_in\">Date</span>.now() — startTime) / <span class=\"hljs-number\">1000</span>)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"23\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">23</span>});<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"24\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">24</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"25\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">25</span>fs.writeFile(<span class=\"hljs-string\">\"./test4.txt\"</span>, <span class=\"hljs-string\">\"test\"</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">err</span>) </span>{<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"26\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">26</span>     <span class=\"hljs-keyword\">if</span> (err) {<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"27\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">27</span>        <span class=\"hljs-built_in\">console</span>.log(err)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"28\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">28</span>    }<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"29\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">29</span>    <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">\"4 Done: %ss\"</span>, (<span class=\"hljs-built_in\">Date</span>.now() — startTime) / <span class=\"hljs-number\">1000</span>)<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"30\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">30</span>});<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">If we attempt to run this code, we will get something that blows our minds. Here is my result:</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"></p><div class=\"story_image_container story_block_image\"><div class=\"story_image\"><div class=\"gatsby-wrapper-image\" style=\"display:inline-block;max-width: 100%;width:400px; margin-left: auto; margin-right: auto;position:relative;\"><div style=\"width:100%;display:block;padding-bottom: 44.921875%;\"></div><img class=\"background_image\" src=\"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='179'%3e%3cpath%20d='M40%201c34%200%2040%200%2041%202%202%201%202%201%200%204l-1%202H5c-4%200-4%200-4%203l1%202v-2c0-2%200-2%201-1%202%202%201%205-1%205H1l-1%203h1c2-2%203-1%203%202l-1%203c-2-1-2%200-2%202s0%202%202%201h1c0%203%200%204-2%203l-1%202c0%202%200%203%202%202l1%202c0%203-2%204-2%201-1-1-1-1-1%201v2h39c38%200%2040%200%2042%202v4c-2%202-4%202-42%202a304%20304%200%2000-38%202c1%200%202%201%202%203l-2%202-1%203c0%202%200%202%202%201h1c0%203%200%204-2%203l-1%202%201%202c3%200%203%204%201%205-2%200-2%201-2%205v4h39c35%200%2040%200%2041%202%202%201%202%201%200%204l-1%202H1v6c0%205%200%205%202%204h1c0%203%200%204-2%203l-1%204%201%204%201-2c-1-3%201-3%201%200%201%202%200%202-1%203l-2%202c0%201%200%202%202%201l1%202H3l-2%201%201%201h1v1l-2%201%2040%201%2041%201v4c-2%202-3%202-42%202H1v6c0%205%200%206%202%205h1c0%203%200%204-2%203l-1%202%201%202c1%200%202%201%202%203l-2%202-1%202%201%201c3%200%203%204%201%205s13%201%2037%201c35%200%2040%200%2041%202%202%201%202%201%200%204l-1%202H1v12h399V0H200L40%201m71%204c-1%203-3%204-3%202h-2c-1%202%200%202%2016%202%2015%200%2017%200%2016-2V4h-2l-2-1h-1v3c0%202-2%203-3%201h-2l-1-2-1-2c-1-1-1%200-1%202l-1%203-1-1c1-4-5-5-6-1-1%202-1%201-1-2l-1-1c-2%200-2%201-1%203l-1%202c-2%200-2-1-1-3V2l-1%203m0%2040l-3%202h-2c-2%201%2025%202%2030%201%203%200%204-3%202-3v-1l-1-1-1%202c-1%202-1%202-1%200l-1-3-1%203c0%202%200%202-3%202l-3-1-1-1v-2l-1%202c0%202%200%202-1%200-2-3-7-3-7%200%200%201%200%202-1%201l-1-1v-2l-1%202-1%202c-1%200-2-1-1-2%200-4-1-4-1%200m0%2039c-1%203-2%204-3%202l-2%201c-1%201%201%201%2016%201s17%200%2016-2v-3h-1l-1%202v1l-1-2c-1-3-1-3-2-2v3c0%202-2%203-3%201h-2c-1-1-2-2-1-3l-1-1-1%203-1%202-1-1c0-2%200-4-1-3l-1%201c1%202%200%202-2%202v-1l1-2c-1-2-3%200-3%202%200%201%200%202-1%201v-2l-1-2c-2%200-2%201-1%203l-1%202c-2%200-2-1-1-3v-3l-1%203m0%2040l-3%202h-2c-2%201%2025%202%2030%201%203%200%204-3%202-3v-1l-1-1-1%202c-1%202-1%202-1%200l-1-3-1%203c0%202%200%202-3%202l-3-1-1-1v-2l-1%202c0%202%200%202-1%200-2-3-7-3-7%200%200%201%200%202-1%201l-1-1v-2l-1%202-1%202c-1%200-2-1-1-2%200-4-1-4-1%200'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e\" style=\"position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"><img src=\"/acorns/static/a8c312b0c6e9ecb1c35689f4429ea39e/e17e5/1588218243013.png\" alt=\"Result of the time it takes to create multiple files\" title=\"Result of the time it takes to create multiple files\" name=\"images/1588218243013.png\" data-src=\"./images/1588218243013.png\" class=\"front_image\" loading=\"lazy\" srcSet=\"/acorns/static/a8c312b0c6e9ecb1c35689f4429ea39e/6f3f2/1588218243013.png 256w,\n/acorns/static/a8c312b0c6e9ecb1c35689f4429ea39e/e17e5/1588218243013.png 400w\" sizes=\"(max-width: 400px) 100vw, 400px\" data-action=\"zoom\" style=\"max-width: 100%;position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"></div><br><div class=\"story_image_caption \">Result of the time it takes to create multiple files</div></div></div><p></p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">First, we will notice that the results are not consistent. Secondly, we see that the time has increased. What’s happening?</p>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"low-level20tasks20get20delegated_8\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"low-level20tasks20get20delegated_8\" class=\"blank_anchor_name\"></a><a id=\"low-level20tasks20get20delegated_8\" class=\"blank_anchor_id\"></a><a name=\"low-level-tasks-get-delegated\" class=\"blank_anchor_name\"></a><a id=\"low-level-tasks-get-delegated\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Low-Level Tasks Get Delegated</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Node.js is single-threaded, as we know now. Parts of Node.js are written in JavaScript, and others in C++. Node.js uses the same concepts of the event loop and the call stack that we are familiar with from the browser environment, meaning that the JavaScript parts of Node.js are single-threaded. But the low-level task that requires speaking with an operating system is not single-threaded.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"></p><div class=\"story_image_container story_block_image\"><div class=\"story_image\"><div class=\"gatsby-wrapper-image\" style=\"display:inline-block;max-width: 100%;width:400px; margin-left: auto; margin-right: auto;position:relative;\"><div style=\"width:100%;display:block;padding-bottom: 97.65625%;\"></div><img class=\"background_image\" src=\"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='390'%3e%3cpath%20d='M106%2031c0%2010%202%2012%202%202l1-6%204%206c6%2010%207%209%207-2s-2-12-2-2v8l-5-8c-6-9-7-9-7%202m40-6c0%203%200%203-2%202-4-2-7%200-7%206s1%207%207%207h4v-9l-1-9-1%203m34-2c-5%203-1%208%205%209l4%203c1%203-6%204-8%202s-4-2-4-1c0%202%204%204%207%204%209%200%2010-8%201-10-5-1-6-2-4-5%202-1%205-1%207%201s4%200%201-2c-1-2-7-2-9-1m22%200c-2%201-1%2017%201%2017l1-3c0-4%200-4%204-4%207%200%2010-6%205-9-2-2-10-3-11-1m-77%205c-2%201-3%208%200%2010%204%205%2011%200%2010-6s-6-7-10-4m28%200c-2%201-3%208%200%2010%201%202%206%202%208%201%201-2%200-3-2-2h-4c-3-2-2-3%202-3%205%200%205%200%205-2%200-3-3-6-5-6l-4%202m76-1c-2%200-4%205-3%208%201%205%206%207%209%203%203-2%202-9%200-10-2-2-3-2-6-1m12%201c-4%204-1%2013%204%2012%202-1%203-1%203%201s-3%203-5%201c-3-1-4-1-2%201l4%202c4%200%206-3%206-11%200-7-1-9-3-7h-1c-1-2-4-1-6%201m22-1c-2%202-1%204%202%202%203-1%205-1%205%201l-2%201c-5%200-8%204-6%207%201%202%205%203%206%201h3c3%202%203%201%202-5-1-7-5-10-10-7m13%206l1%207%201-4%202-7h3l1%207%201%204%201-5c0-5%202-8%204-7l1%207c0%204%200%205%202%205%201%200%202-6%200-11%200-2-4-4-5-2h-10l-1-1-1%207M100%2073v13h99v8l-1%208c-2-1-2%200%200%204%202%205%202%205%204%200l1-4c-2%200-2-1-2-8v-8h99V61l-1%2012v12h-98V73l-1-12-1%2012v12h-98V73l-1-12v12m80%2051l4%2012c6%2014%207%2014%2013%200l4-12c-2-1-4%202-7%2010l-3%209-4-9-5-10h-2m25%202c-2%202-2%205%200%207v3c-3%202-2%208%200%209%207%205%2017-3%2011-9-2-1-2-1%200-3s1-5-1-7c-2-3-8-2-10%200m-89%2025l-1%2049v48l1-44v-53m68%20103l-1%2011v10h8c3%202%206-2%206-8%200-7-4-10-9-7-2%201-2%201-2-3s-1-5-2-3m17%208l1%2010c2%204%2011%205%2015%201%202-3%202-18%200-19l-1%207c0%209-2%2012-6%2012-5%200-6-2-6-11l-1-8c-2%200-2%202-2%208m20-7c10%2024%2010%2024%2016%2010%204-10%205-11%203-11l-5%209-4%209-3-9c-3-5-4-9-6-9l-1%201m-81%2043v12h59v6c0%205%200%206-1%205-2%200-2%201%200%204l1%203a1937%201937%200%20011%202%201724%201724%200%20001-2l2-3v-4c-2%201-2%200-2-5v-6h59v-23l-1%2011v11h-58v-9l-1-9-1%209v9h-58v-11l-1-11v11m-60%2053c-2%203-2%204-2%209%200%207%203%2010%2010%2010%208%200%2012-6%2010-14-2-7-12-10-18-5m145-1c-3%201-3%208%201%209l6%202%204%203c0%204-6%205-10%202-3-2-5-1-2%202%202%202%2011%203%2013%201%205-4%203-9-5-11-4-1-6-2-6-4%200-3%204-4%209-1%204%202%205%201%203-2-2-2-9-3-13-1m-141%202c-6%203-4%2014%202%2016%205%201%208-2%209-8%200-7-5-11-11-8m18%2014l1%2011%202-4c0-3%200-4%204-3%204%200%206-1%207-7%200-6-2-8-8-9h-6v12m19-10c-4%203-4%2011%200%2013%203%202%209%201%2010-1%202-2%200-3-2-1-4%202-6%201-7-2-1-2-1-2%205-2h6v-3c-1-6-9-8-12-4m27%200c-3%202%200%203%203%201%202-2%205-1%205%201s-1%202-3%202c-5%200-7%202-7%206%200%203%201%204%204%204l5-1h2l3%201c2%200%203-1%201-3l-2-6-1-6c-2-2-8-1-10%201m31%206c0%206%200%208%202%208l1-5c0-11%206-13%207-2%200%206%200%207%202%207s3-9%201-13c-1-3-6-4-9-2h-1l-1-1c-2%200-2%202-2%208m18-6v12c1%202%207%203%209%201h1c0%204-5%207-8%204-2-2-3-1-2%201%203%203%208%204%2010%201%203-3%203-4%203-12l-1-9-2%201h-1c-2-2-8-1-9%201m44%200l4%208c2%207%202%2010-2%2010l-1%202%201%201c3%200%206-4%209-13%205-10%204-10%203-10l-4%206-2%207-3-6c-1-4-2-7-4-7l-1%202m18-1c-2%203-1%206%204%208l5%203c0%202-5%202-8%201-2-2-4-1-2%201l6%202c9%200%209-8%200-10-3%200-4-3-1-4l4%201c2%202%204%201%202-1s-8-2-10-1m25%201c-2%201-2%204-2%206%200%205%202%208%207%208%204%200%209-3%206-4l-2%201c-3%202-8%201-8-3l6-1c5%200%205%200%205-2%200-6-8-10-12-5m15%206c0%207%200%208%202%208s2-1%202-6c0-6%200-7%202-7%203-2%204%200%204%207%200%205%200%206%202%206l1-6c0-6%202-9%204-8s2%203%202%207c0%206%200%207%202%207l1-8v-7l-4-1-4%201h-11l-1-1c-2%200-2%202-2%208m-176%2028'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e\" style=\"position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"><img src=\"/acorns/static/6caef665ecbf9895f947fa814dce9326/e17e5/1588218242608.png\" alt=\"Low-level tasks are delegated to the OS through libuv\" title=\"Low-level tasks are delegated to the OS through libuv\" name=\"images/1588218242608.png\" data-src=\"./images/1588218242608.png\" class=\"front_image\" loading=\"lazy\" srcSet=\"/acorns/static/6caef665ecbf9895f947fa814dce9326/6f3f2/1588218242608.png 256w,\n/acorns/static/6caef665ecbf9895f947fa814dce9326/e17e5/1588218242608.png 400w\" sizes=\"(max-width: 400px) 100vw, 400px\" data-action=\"zoom\" style=\"max-width: 100%;position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"></div><br><div class=\"story_image_caption \">Low-level tasks are delegated to the OS through libuv</div></div></div><br>\nWhen a call is recognized by Node.js as being intended for libuv, it delegates this task to libuv. In its operation, libuv requires threads for some of its libraries, hence the use of the thread pool in executing Node.js programs when they are needed.<p></p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">By default, the Node.js thread pool provided by libuv has four threads in it. We could increase or reduce this thread pool by calling <code>process.env.UV_THREADPOOL_SIZE</code> at the top of our script.</p>\n<div class=\"xiaoshujiang_code_container\"><div class=\"xiaoshujiang_pre\"><div class=\"language-javascript hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-comment\">// script.js</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span>process.env.UV_THREADPOOL_SIZE = <span class=\"hljs-number\">6</span>;<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"4\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">4</span><span class=\"hljs-comment\">// …</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"5\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">5</span><span class=\"hljs-comment\">// …</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"what20happens20with20our20file-making20program_9\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"what20happens20with20our20file-making20program_9\" class=\"blank_anchor_name\"></a><a id=\"what20happens20with20our20file-making20program_9\" class=\"blank_anchor_id\"></a><a name=\"what-happens-with-our-file-making-program\" class=\"blank_anchor_name\"></a><a id=\"what-happens-with-our-file-making-program\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">What Happens With Our File-Making Program</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">It appears that once we invoke the code to create our file, Node.js hits the libuv part of its code, which dedicates a thread for this task. This section in libuv gets some statistical information about the disk before working on the file.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">This statistical checking could take a while to complete; hence, the thread is released for some other tasks until the statistical check is completed. When the check is completed, the libuv section occupies any available thread or waits until a thread becomes available for it.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">We have only four calls and four threads, so there are enough threads to go around. The only question is how fast each thread will process its task. We will notice that the first code to make it into the thread pool will return its result first, and it blocks all of the other threads while running its code.</p>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"conclusion_10\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"conclusion_10\" class=\"blank_anchor_name\"></a><a id=\"conclusion_10\" class=\"blank_anchor_id\"></a><a name=\"conclusion\" class=\"blank_anchor_name\"></a><a id=\"conclusion\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Conclusion</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">We now understand what Node.js is. We know it’s a runtime. We’ve defined what a runtime is. And we’ve dug deep into what makes up the runtime provided by Node.js.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">We have come a long way. And from our little tour of the <a href=\"https://github.com/nodejs/node\" class=\"xsj_link xsj_manu_link\">Node.js repository on GitHub</a>, we can explore any API we might be interested in, following the same process we took here. Node.js is open source, so surely we can dive into the source, can’t we?</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Even though we have touched on several of the low levels of what happens in the Node.js runtime, we mustn’t assume that we know it all. The resources below point to some information on which we can build our knowledge:</p>\n<ul class=\"markdown_ul\">\n<li><a href=\"https://nodejs.dev/\" class=\"xsj_link xsj_manu_link\">Introduction to Node.js</a><br>\nBeing an official website, Node.dev explains what Node.js is, as well as its package managers, and lists web frameworks built on top of it.</li>\n<li><span class=\"xsj_placeholder_span\"></span>“<a href=\"https://www.nodebeginner.org/#javascript-and-nodejs\" class=\"xsj_link xsj_manu_link\">JavaScript &amp; Node.js</a>”, <em class=\"markdown_em_underline\">The Node Beginner Book</em><br>\nThis book by <a href=\"https://twitter.com/manuelkiessling\" class=\"xsj_link xsj_manu_link\">Manuel Kiessling</a> does a fantastic job of explaining Node.js, after warning that JavaScript in the browser is not the same as the one in Node.js, even though both are written in the same language.</li>\n<li><em class=\"markdown_em_underline\"><a href=\"https://www.amazon.com/Beginning-Node-js-Basarat-Syed/\" class=\"xsj_link xsj_manu_link\">Beginning Node.js</a></em><br>\nThis beginner book goes beyond an explanation of the runtime. It teaches about packages and streams and creating a web server with the Express framework.</li>\n<li><a href=\"http://docs.libuv.org/en/v1.x/\" class=\"xsj_link xsj_manu_link\">LibUV</a><br>\nThis is the official documentation of the supporting C++ code of the Node.js runtime.</li>\n<li><a href=\"https://v8.dev/docs\" class=\"xsj_link xsj_manu_link\">V8</a><br>\nThis is the official documentation of the JavaScript engine that makes it possible to write Node.js with JavaScript.</li>\n</ul>\n</div>\n\n","excerpt":"Since the introduction of Node.js by Ryan Dahl at the European JSConf on 8 November 2009, it has seen wide usage across the tech industry. C...","docType":"posts","slug":"tech/nodejs-internals","title":"Exploring Node.js Internals","customCss":"","createDate":"April 30, 2020","updateDate":"April 30, 2020","tags":["文章","转载","技术","English","nodejs"]}},"pageContext":{"slug":"tech/nodejs-internals","zipPath":"/home/runner/work/acorns/acorns/posts/english/Exploring Node.js Internals.zip","prev":{"title":"2020-4-29 工作日志","docType":"posts","slug":"daily-notes/2020-04-29"},"next":{"title":"Using CSS to Control Text Selection","docType":"posts","slug":"tech/using-css-to-control-text-selection"},"pluginOptions":{"tagsPath":"/tags/","archivesPath":"/archives/","basePath":"/","commentType":"gitalk"},"basePath":"/"}},"staticQueryHashes":["2682448919","2682448919"]}