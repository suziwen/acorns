{"componentChunkName":"component---node-modules-suziwen-gatsby-theme-sculpting-src-templates-template-blog-post-js","path":"/https:/jojime/en-us/blog/processing-huge-files-using-filereader-readasarraybuffer-in-web-browser","result":{"data":{"zipFile":{"publicURL":"/acorns/static/3f16afbc20e88813115764c06971c636/Processing huge files using FileReader.readAsArrayBuffer() in web browser.zip"},"site":{"siteMetadata":{"siteUrl":"https://suziwen.github.io/acorns"}},"storyWriterMarkdown":{"id":"49bc63a0-6df9-5aaf-9f87-9d139056c1de","html":"\n\n\t<div class=\"preview html_preview xsj_export_zip\"><div style=\"overflow: hidden; position: absolute; top: 0; height: 1px; width: auto; padding: 0; border: 0; margin: 0; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;\"><svg><defs id=\"MathJax_SVG_glyphs\"/><defs xmlns=\"http://www.w3.org/2000/svg\"><filter xmlns=\"http://www.w3.org/2000/svg\" id=\"dropshadow\" height=\"130%\">      <fegaussianblur in=\"SourceAlpha\" stddeviation=\"3\"/>       <feoffset dx=\"2\" dy=\"2\" result=\"offsetblur\"/>       <femerge>         <femergenode/>        <femergenode in=\"SourceGraphic\"/>       </femerge>    </filter><filter id=\"editing-stripe-bk\" filterunits=\"userSpaceOnUse\" x=\"-100%\" y=\"-100%\" width=\"300%\" height=\"300%\"><feflood flood-color=\"#700f0f\" result=\"flood1\"/><feflood flood-color=\"#fff\" flood-opacity=\"0.5\" result=\"flood2\"/><feimage xlink:href=\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAwcHgiIGhlaWdodD0iMTAwMHB4Ij48ZGVmcz48cGF0dGVybiBpZD0icGF0dGVybiIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeD0iMCIgeT0iMCIgd2lkdGg9IjQiIGhlaWdodD0iNCI+PHBhdGggZD0iTSAtNCAtNCBMIDggOCBNIC04IC00IEwgNCA4IE0gLTQgLTggTCA4IDQiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI3BhdHRlcm4pIi8+PC9zdmc+\" x=\"0\" y=\"0\" width=\"2000\" height=\"1000\" result=\"image\"/><fetile in=\"image\" result=\"tile\"/><fecomposite operator=\"in\" in=\"flood1\" in2=\"tile\" result=\"tile2\"/><fegaussianblur in=\"SourceAlpha\" stddeviation=\"10\" result=\"blur\"/><fecomposite operator=\"in\" in=\"tile2\" in2=\"blur\" result=\"cloud\"/><femorphology operator=\"dilate\" radius=\"2\" in=\"SourceAlpha\" result=\"dilate\"/><fecomposite operator=\"in\" in=\"flood2\" in2=\"dilate\" result=\"base\"/><femerge><femergenode in=\"cloud\"/><femergenode in=\"base\"/><femergenode in=\"SourceGraphic\"/></femerge></filter></defs></svg></div><blockquote class=\"markdown_blockquote\">\n<p class=\"xsj_paragraph xsj_paragraph_level_1\"><span class=\"xsj_placeholder_span\"></span>本文为转载文章, 仅用于自己的知识管理收集, 如果涉及侵权,请联系 <a href=\"mailto:suziwen1@gmail.com\" class=\"xsj_link xsj_auto_link\">suziwen1@gmail.com</a>,会第一时间删除<br>\n收集该文章,并非代表本人支持文中观点,只是觉得文章内容容易引起思考,讨论,有它自有的价值</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_1\"><span class=\"xsj_placeholder_span\"></span>转载自: <a href=\"https://joji.me/en-us/blog/processing-huge-files-using-filereader-readasarraybuffer-in-web-browser/\" class=\"xsj_link xsj_auto_link\">https://joji.me/en-us/blog/processing-huge-files-using-filereader-readasarraybuffer-in-web-browser/</a></p>\n</blockquote>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"></p><div class=\"toc mindmap_toc mindmap_container\" data-vdom-skip=\"true\" data-hash=\"0c25c93a3077b68d9561867e329ba12c_mindmap_toc\"><div class=\"xsj_mindmap xsj_mindmap_toc\"><svg id=\"xsj_mindmap_toc_1627621127990\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" class=\"xsj_svg_viewbox\" style=\"max-width:1715px;max-height:290px;\" viewbox=\"0 0 1715 290\" width=\"100%\" height=\"100%\"><g transform=\"translate(716.5,167) scale(1)\"><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"2\" d=\"M603.5,-39 L608.5,-39 C644.5,-39 639.5,37 675.5,37 L677.5,37\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(603.5, -39)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(675.5,37)\"><path class=\"markmap-node-path\" d=\"M0,0L274,0\" stroke-width=\"2\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(274, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"2\" d=\"M603.5,-39 L608.5,-39 C644.5,-39 639.5,-37 675.5,-37 L677.5,-37\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(603.5, -39)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(675.5,-37)\"><path class=\"markmap-node-path\" d=\"M0,0L226,0\" stroke-width=\"2\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(226, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"2\" d=\"M603.5,-39 L608.5,-39 C644.5,-39 639.5,-111 675.5,-111 L677.5,-111\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(603.5, -39)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: white;\"/><g transform=\"translate(675.5,-111)\"><path class=\"markmap-node-path\" d=\"M0,0L88,0\" stroke-width=\"2\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(88, 0)\" points=\"0,-1 5,0 0,1 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-link\" style=\"fill:none;\"><path stroke=\"#3366cc\" stroke-width=\"4\" d=\"M480.5,-39 L485.5,-39 C557.5,-39 552.5,-39 588.5,-39 L590.5,-39\"/><polygon class=\"markmap-link-polygon\" stroke-width=\"0\" transform=\"translate(480.5, -39)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: white;\"/><g transform=\"translate(588.5,-39)\"><path class=\"markmap-node-path\" d=\"M0,0L14,0\" stroke-width=\"4\" stroke=\"#3366cc\"/><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(14, 0)\" points=\"0,-2 5,0 0,2 -5,0\" style=\"fill: rgb(51, 102, 204);\"/></g></g><g class=\"markmap-node markmap-root-node\" transform=\"translate(-624.5,-39)\"><polygon class=\"markmap-node-polygon\" stroke-width=\"0\" transform=\"translate(1104, 0)\" points=\"0,-3 5,0 0,3 -5,0\" style=\"fill: rgb(51, 102, 204);\"/><g transform=\"translate(1, -34)\"><rect class=\"markmap-node-rect\" rx=\"10\" ry=\"10\" height=\"68\" width=\"1103\" fill=\"rgb(78, 156, 255)\" stroke=\"#3366cc\" stroke-width=\"1\"/><text class=\"markmap-node-text\" alignment-baseline=\"middle\" x=\"552.5\" y=\"38\" text-anchor=\"middle\" style=\"font: bolder 30px sans-serif; fill-opacity: 1; fill: rgb(255, 255, 255);\">Processing huge files using FileReader.readAsArrayBuffer() in web browser</text></g></g><g class=\"markmap-node\" transform=\"translate(588.5,-39)\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px;\"/><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 20px sans-serif; fill: rgb(51, 102, 204);\"/></g><g class=\"markmap-node\" transform=\"translate(675.5,37)\"><a xlink:href=\"#implementation20using20_3\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;\">Implementation using readAsArrayBuffer()</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;\">Implementation using readAsArrayBuffer()</text></a></g><g class=\"markmap-node\" transform=\"translate(675.5,-37)\"><a xlink:href=\"#implementation20using20_2\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;\">Implementation using readAsText()</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;\">Implementation using readAsText()</text></a></g><g class=\"markmap-node\" transform=\"translate(675.5,-111)\"><a xlink:href=\"#test20scenario_1\"><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); stroke: white; stroke-width: 2px; cursor: pointer;\">Test Scenario</text><text class=\"markmap-node-text\" y=\"-5\" text-anchor=\"start\" x=\"0\" style=\"fill-opacity: 1; font: 15px sans-serif; fill: rgb(51, 102, 204); cursor: pointer;\">Test Scenario</text></a></g><g class=\"annotation-group\"><g class=\"annotations\"/></g></g></svg></div></div><p></p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">The <a href=\"https://developer.mozilla.org/en/docs/Web/API/FileReader\" class=\"xsj_link xsj_manu_link\"><code>FileReader</code></a> API in HTML5 allows web browsers to access user files without uploading the files to the web servers. It not only lightens the load of web server but also saves the time of uploading files. It is very easy to use <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/FileReader/readAsText\" class=\"xsj_link xsj_manu_link\"><code>FileReader.readAsText()</code></a> to process a 300K log file. However, when the file size grows to 1GB, or even 2GB, then the page might crash in browser or not function correctly. This is because <code>readAsText()</code> loads the full file into memory before processing it. As a result, the process memory exceeds the limitation. To prevent this issue, we should use <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/FileReader/readAsArrayBuffer\" class=\"xsj_link xsj_manu_link\"><code>FileReader.readAsArrayBuffer()</code></a> to stream the file when the web application needs to process huge files, so you only hold a part of the file in the memory.</p>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"test20scenario_1\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"test20scenario_1\" class=\"blank_anchor_name\"></a><a id=\"test20scenario_1\" class=\"blank_anchor_id\"></a><a name=\"test-scenario\" class=\"blank_anchor_name\"></a><a id=\"test-scenario\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Test Scenario</span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Our test scenario is to get the log time range using JavaScript from a given IIS log on local disk.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Sample IIS log:</p>\n<div class=\"xiaoshujiang_code_container\"><div data-processed=\"true\" class=\"xiaoshujiang_pre\"><div class=\"nohighlight hljs code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span>#Software: Microsoft Internet Information Services 10.0<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span>#Version: 1.0<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span>#Date: 2016-08-18 06:53:55<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"4\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">4</span>#Fields: date time s-ip cs-method cs-uri-stem cs-uri-query s-port cs-username c-ip cs(User-Agent) cs(Referer) sc-status sc-substatus sc-win32-status time-taken<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"5\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">5</span>2016-08-18 06:53:55 ::1 GET / - 80 - ::1 Mozilla/5.0+(Windows+NT+10.0;+WOW64;+Trident/7.0;+rv:11.0)+like+Gecko - 200 0 0 476<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"6\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">6</span>2016-08-18 06:53:55 ::1 GET /iisstart.png - 80 - ::1 Mozilla/5.0+(Windows+NT+10.0;+WOW64;+Trident/7.0;+rv:11.0)+like+Gecko http://localhost/ 200 0 0 3<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"7\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">7</span>2016-08-18 08:45:34 10.172.19.198 GET /test/pac/wpad.dat - 80 - 10.157.21.235 Mozilla/5.0+(Windows+NT+6.1;+Win64;+x64;+Trident/7.0;+rv:11.0)+like+Gecko - 404 3 50 265<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"8\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">8</span>2016-08-18 08:46:44 10.172.19.198 GET /test/pac/wpad.dat - 80 - 10.157.21.235 Mozilla/5.0+(Windows+NT+6.1;+Win64;+x64;+Trident/7.0;+rv:11.0)+like+Gecko - 200 0 0 6<span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Our target is to get the time range of this IIS log</p>\n<ul class=\"markdown_ul\">\n<li><span class=\"xsj_placeholder_span\"></span>Start time: 2016-08-18 06:53:55</li>\n<li><span class=\"xsj_placeholder_span\"></span>End time: 2016-08-18 08:46:44</li>\n</ul>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"implementation20using20_2\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"implementation20using20_2\" class=\"blank_anchor_name\"></a><a id=\"implementation20using20_2\" class=\"blank_anchor_id\"></a><a name=\"implementation-using\" class=\"blank_anchor_name\"></a><a id=\"implementation-using\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Implementation using <code>readAsText()</code></span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">It is quite easy and clear to implement the functionality using <code>readAsText()</code>. After getting the whole content of the file in a string, iterates each line from the beginning and get the string of first 19 characters, then check if it matches the date and time format. If it does, the string is the start time. In the same way, get the end time by iterating each line from the end.</p>\n<div class=\"xiaoshujiang_code_container\"><div data-processed=\"true\" class=\"xiaoshujiang_pre\"><div class=\"language-html hljs xml code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"file\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"file\"</span> /&gt;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"get-time\"</span>&gt;</span>Get Time<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"javascript\"></span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"4\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">4</span><span class=\"hljs-tag\">    <span class=\"hljs-built_in\">document</span>.getElementById(<span class=\"hljs-string\">'get-time'</span>).onclick = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) </span>{</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"5\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">5</span><span class=\"hljs-tag\">        <span class=\"hljs-keyword\">let</span> file = <span class=\"hljs-built_in\">document</span>.getElementById(<span class=\"hljs-string\">'file'</span>).files[<span class=\"hljs-number\">0</span>];</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"6\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">6</span><span class=\"hljs-tag\">        <span class=\"hljs-keyword\">let</span> fr = <span class=\"hljs-keyword\">new</span> FileReader();</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"7\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">7</span><span class=\"hljs-tag\">        fr.onload = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">e</span>) </span>{</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"8\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">8</span><span class=\"hljs-tag\">            <span class=\"hljs-keyword\">let</span> startTime = getTime(e.target.result, <span class=\"hljs-literal\">false</span>);</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"9\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">9</span><span class=\"hljs-tag\">            <span class=\"hljs-keyword\">let</span> endTime = getTime(e.target.result, <span class=\"hljs-literal\">true</span>);</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"10\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">10</span><span class=\"hljs-tag\">            alert(<span class=\"hljs-string\">`Log time range: <span class=\"hljs-subst\">${startTime}</span> ~ <span class=\"hljs-subst\">${endTime}</span>`</span>);</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"11\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">11</span><span class=\"hljs-tag\">        }</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"12\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">12</span><span class=\"hljs-tag\">        fr.readAsText(file);</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"13\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">13</span><span class=\"hljs-tag\">    }</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"14\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">14</span><span class=\"hljs-tag\">    <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getTime</span>(<span class=\"hljs-params\">text, reverse</span>) </span>{</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"15\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">15</span><span class=\"hljs-tag\">        <span class=\"hljs-keyword\">let</span> timeReg = <span class=\"hljs-regexp\">/\\d{4}\\-\\d{2}\\-\\d{2} \\d{2}:\\d{2}:\\d{2}/</span>;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"16\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">16</span><span class=\"hljs-tag\">        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> i = reverse ? text.length - <span class=\"hljs-number\">1</span> : <span class=\"hljs-number\">0</span>; reverse ? i &gt; <span class=\"hljs-number\">-1</span> : i &lt; text.length; reverse ? i-- : i++) {</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"17\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">17</span><span class=\"hljs-tag\">            <span class=\"hljs-keyword\">if</span> (text[i].charCodeAt() === <span class=\"hljs-number\">10</span>) {</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"18\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">18</span><span class=\"hljs-tag\">                <span class=\"hljs-keyword\">let</span> snippet = text.substr(i + <span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">19</span>);</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"19\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">19</span><span class=\"hljs-tag\">                <span class=\"hljs-keyword\">if</span> (timeReg.exec(snippet)) {</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"20\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">20</span><span class=\"hljs-tag\">                    <span class=\"hljs-keyword\">return</span> snippet;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"21\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">21</span><span class=\"hljs-tag\">                }</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"22\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">22</span><span class=\"hljs-tag\">            }</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"23\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">23</span><span class=\"hljs-tag\">        }</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"24\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">24</span><span class=\"hljs-tag\">    }</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"25\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">25</span><span class=\"hljs-tag\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">The result of processing the sample IIS log (file size: 1K) matches our expectation.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"></p><div class=\"story_image_container story_block_image\"><div class=\"story_image\"><div class=\"gatsby-wrapper-image\" style=\"display:inline-block;max-width: 100%;width:1024px; margin-left: auto; margin-right: auto;position:relative;\"><div style=\"width:100%;display:block;padding-bottom: 94.92187499999999%;\"></div><img class=\"background_image\" src=\"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='380'%3e%3cpath%20d='M349%20104v103H51v28H35c-15%200-16%200-17-2-1-3-3-3-4%200%200%202-1%202-7%202l18%201h26v136H0v8h198a2201%202201%200%2000202-2V0h-52l1%20104M87%20189'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e\" style=\"position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"><div class=\"gif_player\"><div class=\"play_button\"></div><img src=\"/acorns/static/fa677ddb7ee404cc044e898dc879a386/71f05/1614578336914.gif\" data-vdom-skip=\"true\" data-vdom-cache=\"true\" alt title name=\"images/1614578336914.gif\" data-src=\"/acorns/static/1614578336914-fa677ddb7ee404cc044e898dc879a386.gif\" class=\"front_image\" loading=\"lazy\" data-still=\"/acorns/static/fa677ddb7ee404cc044e898dc879a386/71f05/1614578336914.gif\" style=\"max-width: 100%;position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"></div></div><br><div class=\"story_image_caption story_image_blank_caption\"></div></div></div><p></p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">However, the browser crashed if I chose a huge IIS log file (size: 2G) because <code>readAsText()</code> loaded the full file into memory and the process memory exceeds the limitation</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"></p><div class=\"story_image_container story_block_image\"><div class=\"story_image\"><div class=\"gatsby-wrapper-image\" style=\"display:inline-block;max-width: 100%;width:1024px; margin-left: auto; margin-right: auto;position:relative;\"><div style=\"width:100%;display:block;padding-bottom: 94.92187499999999%;\"></div><img class=\"background_image\" src=\"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='380'%3e%3cpath%20d='M349%20104v103H51v21l-6-1h-7l-9%201c-9%200-10-1-10-2-1-4-5-4-5-1%200%202%200%202-7%202l-7%201%2026%201h25v143H0v8h198a2201%202201%200%2000202-2V0h-52l1%20104M87%20189'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e\" style=\"position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"><div class=\"gif_player\"><div class=\"play_button\"></div><img src=\"/acorns/static/6b8dcd04d08bde08572f827156367ed7/71f05/1614578336920.gif\" data-vdom-skip=\"true\" data-vdom-cache=\"true\" alt title name=\"images/1614578336920.gif\" data-src=\"/acorns/static/1614578336920-6b8dcd04d08bde08572f827156367ed7.gif\" class=\"front_image\" loading=\"lazy\" data-still=\"/acorns/static/6b8dcd04d08bde08572f827156367ed7/71f05/1614578336920.gif\" style=\"max-width: 100%;position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"></div></div><br><div class=\"story_image_caption story_image_blank_caption\"></div></div></div><p></p>\n<h3 class=\"xsj_heading_hash xsj_heading xsj_heading_h3\" id=\"implementation20using20_3\"><div class=\"xiaoshujiang_element xsj_anchor\">\n  <a name=\"implementation20using20_3\" class=\"blank_anchor_name\"></a><a id=\"implementation20using20_3\" class=\"blank_anchor_id\"></a><a name=\"implementation-using\" class=\"blank_anchor_name\"></a><a id=\"implementation-using\" class=\"blank_anchor_id\"></a>\n</div>\n<span class=\"xsj_heading_content\">Implementation using <code>readAsArrayBuffer()</code></span></h3>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">A <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/File\" class=\"xsj_link xsj_manu_link\"><code>File</code></a> object in JavaScript is inherited from <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Blob\" class=\"xsj_link xsj_manu_link\"><code>Blob</code></a> object. We can use <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Blob/slice\" class=\"xsj_link xsj_manu_link\"><code>Blob.slice()</code></a> to cut the file into pieces for further processing. The workflow is as below:</p>\n<ul class=\"markdown_ul\">\n<li><span class=\"xsj_placeholder_span\"></span>Gets the first 10KB of the file and decode it to text</li>\n<li><span class=\"xsj_placeholder_span\"></span>Iterates each line from the beginning of the text and checks whether the string of first 19 characters matches the date and time format. If it does, then the string is the start time</li>\n<li><span class=\"xsj_placeholder_span\"></span>Gets the last 10KB of the file and decode it to text</li>\n<li><span class=\"xsj_placeholder_span\"></span>In the same way, get the end time by iterating each line from the end</li>\n</ul>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Here is the code:</p>\n<div class=\"xiaoshujiang_code_container\"><div data-processed=\"true\" class=\"xiaoshujiang_pre\"><div class=\"language-html hljs xml code_linenums xiaoshujiang_code\"><ol start=\"1\" class=\"ol_linenums\" style=\"counter-reset: lines 0;\"><li class=\"li_linenum \" date-linenum=\"1\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">1</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"file\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"file\"</span> /&gt;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"2\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">2</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"get-time\"</span>&gt;</span>Get Time<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"3\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">3</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"javascript\"></span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"4\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">4</span><span class=\"hljs-tag\">    <span class=\"hljs-built_in\">document</span>.getElementById(<span class=\"hljs-string\">'get-time'</span>).onclick = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) </span>{</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"5\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">5</span><span class=\"hljs-tag\">        <span class=\"hljs-keyword\">let</span> file = <span class=\"hljs-built_in\">document</span>.getElementById(<span class=\"hljs-string\">'file'</span>).files[<span class=\"hljs-number\">0</span>];</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"6\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">6</span><span class=\"hljs-tag\">        <span class=\"hljs-keyword\">let</span> fr = <span class=\"hljs-keyword\">new</span> FileReader();</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"7\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">7</span><span class=\"hljs-tag\">        <span class=\"hljs-keyword\">let</span> CHUNK_SIZE = <span class=\"hljs-number\">10</span> * <span class=\"hljs-number\">1024</span>;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"8\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">8</span><span class=\"hljs-tag\">        <span class=\"hljs-keyword\">let</span> startTime, endTime;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"9\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">9</span><span class=\"hljs-tag\">        <span class=\"hljs-keyword\">let</span> reverse = <span class=\"hljs-literal\">false</span>;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"10\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">10</span><span class=\"hljs-tag\">        fr.onload = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) </span>{</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"11\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">11</span><span class=\"hljs-tag\">            <span class=\"hljs-keyword\">let</span> buffer = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Uint8Array</span>(fr.result);</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"12\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">12</span><span class=\"hljs-tag\">            <span class=\"hljs-keyword\">let</span> timeReg = <span class=\"hljs-regexp\">/\\d{4}\\-\\d{2}\\-\\d{2} \\d{2}:\\d{2}:\\d{2}/</span>;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"13\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">13</span><span class=\"hljs-tag\">            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> i = reverse ? buffer.length - <span class=\"hljs-number\">1</span> : <span class=\"hljs-number\">0</span>; reverse ? i &gt; <span class=\"hljs-number\">-1</span> : i &lt; buffer.length; reverse ? i-- : i++) {</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"14\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">14</span><span class=\"hljs-tag\">                <span class=\"hljs-keyword\">if</span> (buffer[i] === <span class=\"hljs-number\">10</span>) {</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"15\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">15</span><span class=\"hljs-tag\">                    <span class=\"hljs-keyword\">let</span> snippet = <span class=\"hljs-keyword\">new</span> TextDecoder(<span class=\"hljs-string\">'utf-8'</span>).decode(buffer.slice(i + <span class=\"hljs-number\">1</span>, i + <span class=\"hljs-number\">20</span>));</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"16\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">16</span><span class=\"hljs-tag\">                    <span class=\"hljs-keyword\">if</span> (timeReg.exec(snippet)) {</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"17\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">17</span><span class=\"hljs-tag\">                        <span class=\"hljs-keyword\">if</span> (!reverse) {</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"18\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">18</span><span class=\"hljs-tag\">                            startTime = snippet;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"19\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">19</span><span class=\"hljs-tag\">                            reverse = <span class=\"hljs-literal\">true</span>;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"20\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">20</span><span class=\"hljs-tag\">                            seek();</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"21\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">21</span><span class=\"hljs-tag\">                        } <span class=\"hljs-keyword\">else</span> {</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"22\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">22</span><span class=\"hljs-tag\">                            endTime = snippet;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"23\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">23</span><span class=\"hljs-tag\">                            alert(<span class=\"hljs-string\">`Log time range: <span class=\"hljs-subst\">${startTime}</span> ~ <span class=\"hljs-subst\">${endTime}</span>`</span>);</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"24\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">24</span><span class=\"hljs-tag\">                        }</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"25\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">25</span><span class=\"hljs-tag\">                        <span class=\"hljs-keyword\">break</span>;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"26\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">26</span><span class=\"hljs-tag\">                    }</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"27\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">27</span><span class=\"hljs-tag\">                }</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"28\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">28</span><span class=\"hljs-tag\">            }</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"29\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">29</span><span class=\"hljs-tag\">        }</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"30\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">30</span><span class=\"hljs-tag\">        seek();</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"31\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">31</span><span class=\"hljs-tag\">        <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">seek</span>(<span class=\"hljs-params\"></span>) </span>{</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"32\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">32</span><span class=\"hljs-tag\">            <span class=\"hljs-keyword\">let</span> start = reverse ? file.size - CHUNK_SIZE : <span class=\"hljs-number\">0</span>;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"33\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">33</span><span class=\"hljs-tag\">            <span class=\"hljs-keyword\">let</span> end = reverse ? file.size : CHUNK_SIZE;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"34\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">34</span><span class=\"hljs-tag\">            <span class=\"hljs-keyword\">let</span> slice = file.slice(start, end);</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"35\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">35</span><span class=\"hljs-tag\">            fr.readAsArrayBuffer(slice);</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"36\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">36</span><span class=\"hljs-tag\">        }</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"37\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">37</span><span class=\"hljs-tag\">    }</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li><li class=\"li_linenum \" date-linenum=\"38\"><span class=\"li_linenum_before_span li_linenum_before_span_hide\">38</span><span class=\"hljs-tag\"></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><span style=\"user-select:none;display:none;\">&nbsp;</span><br class=\"code_line_break_hack_br\"><hr class=\"code_line_break_hack_hr code_line_break_hack\" style=\"margin:0;border:0;border-top:0;border-bottom:0;\"></li></ol></div></div></div>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\">Now we can get the expected result very quickly for a 2GB IIS log after using <code>readAsArrayBuffer</code>.</p>\n<p class=\"xsj_paragraph xsj_paragraph_level_0\"></p><div class=\"story_image_container story_block_image\"><div class=\"story_image\"><div class=\"gatsby-wrapper-image\" style=\"display:inline-block;max-width: 100%;width:1024px; margin-left: auto; margin-right: auto;position:relative;\"><div style=\"width:100%;display:block;padding-bottom: 94.92187499999999%;\"></div><img class=\"background_image\" src=\"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='380'%3e%3cpath%20d='M348%2094l1%2094H174L0%20189h349v18H51v21l-6-1h-7l-9%201c-9%200-10-1-10-2-1-4-5-4-5-1%200%202%200%202-7%202l-7%201%2026%201h25v143H0v8h198a2201%202201%200%2000202-2V0h-52v94'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e\" style=\"position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"><div class=\"gif_player\"><div class=\"play_button\"></div><img src=\"/acorns/static/4ce2cc4d9142603112ab81263636cb10/71f05/1614578336918.gif\" data-vdom-skip=\"true\" data-vdom-cache=\"true\" alt title name=\"images/1614578336918.gif\" data-src=\"/acorns/static/1614578336918-4ce2cc4d9142603112ab81263636cb10.gif\" class=\"front_image\" loading=\"lazy\" data-still=\"/acorns/static/4ce2cc4d9142603112ab81263636cb10/71f05/1614578336918.gif\" style=\"max-width: 100%;position: absolute;top:0;left:0;width: 100%;height:100%;object-fit: cover;object-position: center;\"></div></div><br><div class=\"story_image_caption story_image_blank_caption\"></div></div></div><p></p>\n</div>\n\n","excerpt":"The FileReader API in HTML5 allows web browsers to access user files without uploading the files to the web servers. It not only lightens th...","docType":"posts","slug":"https:/jojime/en-us/blog/processing-huge-files-using-filereader-readasarraybuffer-in-web-browser","title":"Processing huge files using FileReader.readAsArrayBuffer() in web browser","customCss":"","createDate":"March 01, 2021","updateDate":"March 01, 2021","tags":["文章","转载","技术","前端","性能"]}},"pageContext":{"slug":"https:/jojime/en-us/blog/processing-huge-files-using-filereader-readasarraybuffer-in-web-browser","zipPath":"/home/runner/work/acorns/acorns/posts/web/Processing huge files using FileReader.readAsArrayBuffer() in web browser.zip","prev":{"title":"filereader api on big files","docType":"posts","slug":"https:/stackoverflowcom/questions/25810051/filereader-api-on-big-files"},"next":{"title":"Read n lines of a big text file","docType":"posts","slug":"https:/stackoverflowcom/questions/39479090/read-n-lines-of-a-big-text-file"},"pluginOptions":{"tagsPath":"/tags/","archivesPath":"/archives/","basePath":"/","commentType":"gitalk"},"basePath":"/"}},"staticQueryHashes":["2682448919","2682448919"]}